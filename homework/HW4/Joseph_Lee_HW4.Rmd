---
title: "STAT 385 HW4"
author: ""
date: "Due by 12:00 PM on 10/26/2019"
output: html_document
---


## HW 4 Problems

Below you will find problems for you to complete as an individual. It is fine to discuss the homework problems with classmates, but cheating is prohibited and will be harshly penalized if detected.

### 1. Modify the scaler function in the Week 7 notes.

We created a function called `scalar` in the Week 7 Notes. This function takes a numeric or integer vector as an input (check this on your own) and it outputs the scaled numeric or integer vectors as an output. Make a new version of this function that 1) takes a dataframe as an argument 2) scales all of the numeric and integer-valued columns of that dataframe while leaving all other variables alone 3) returns the original dataframe with scaled numeric and integer-valued columns. Verify that your function is working by testing it on two dataframes. The first dataframe can be anything that you want. The second dataframe should consist of only factor variables, i.e. the function should do nothing to this dataframe and also should not output an error message. Your verification checks should be readable, do not simply report the returned dataframes.
```{r}
scaler = function(df) {
  for (i in 1:length(df)) {
    if (class(df[,i]) %in% c("integer","numeric")) {
      df[,i] = (df[,i] - mean(df[,i]))/sd(df[,i])
    }
  }
  return(df)
}
```

```{r, eval = FALSE}
library(car)
scaler(Prestige)
df = mtcars
colnames(df) = gsub("mpg","id",colnames(df))
df$am = as.factor(df$am)
df$gear = as.factor(df$gear)
df$id = as.factor(df$id)

df[,sapply(df, is.factor) & colnames(df) != "id"]
scaler(df)
```


### 2. Using the Chicago Food Inspections Data, do the following:

a. create a visualization (plot) of at least two variables using this dataset
```{r}
library(tidyverse)
food = read.csv("Food_Inspections.csv")
toPlot = filter(food, Facility.Type == "Bakery")
plot(Longitude~Latitude, data = toPlot, col = Risk)
```

b. explain what is good and what is bad about the visualization
 - Good: The visualization plots points of longitude and latitude, imitating a map of the bakeries in the data, and attempts to  convey the difference in risk levels between all the facilities.
 - Bad: Colors and point types are poorly chosen in focusing in on risk levels, as well as missing labels.
c. show a substantially improved visualization
```{r}
color = rep("gray", length(toPlot$Risk))
color[which(toPlot$Risk == "Risk 1 (High)")] = "red"

plot(Longitude~Latitude, main = "Bakeries by Coordinates", data = toPlot, col = color, pch = 19)
text(41.95, -87.55, labels = "HIGH RISK", col = "red", cex = 1.4)
text(41.95,-87.580, labels = "adversely affecting public health", col = "red", cex = .8)
```

d. describe the improvement and why the improved plot in part **c** helps the reader/viewer more than the original plot in part **a**.

This plot better labels and explains the data in a more simple and understandable way. Instead of trying to differentiate between all risk levels, it highlights the high risk levels and mutes the rest of the bakeries across the map, labeling points accordingly.

### 3. Using the Chicago Food Inspections Data, do the following:

a. create a table of descriptive statistics of your choice
```{r}
usable = droplevels(filter(food, Results %in% c("Pass","Fail"), Facility.Type %in% c("Bakery","Restaurant")))
table(usable$Results, usable$Facility.Type)/sum(table(usable$Results, usable$Facility.Type))
```

b. add one descriptive statistic to the plot in part **1c**
```{r}
color = rep("gray", length(toPlot$Risk))
color[which(toPlot$Risk == "Risk 1 (High)")] = "orange"
color[which(toPlot$Risk == "Risk 1 (High)" & toPlot$Results == "Fail")] = "red"
plot(Longitude~Latitude, main = "Bakeries by Coordinates", data = toPlot, col = color, pch = 19)
text(41.95, -87.55, labels = "FAILED", col = "red", cex = 1.4)
text(41.95,-87.580, labels = "Failed Inspection with HIGH Risk", col = "red", cex = .8)
text(41.84, -87.78, labels = "HIGH RISK", col = "orange", cex = 1.4)
text(41.84,-87.81, labels = "Adversely affecting public health", col = "orange", cex = .8)
```

c. write a brief explanatory narrative of the visualization in part **2b**. In your explanation, be convincing and persuasive about your visualization. Attempt to highlight why this visualization is crucial to your imaginary supervisor.

This visual, like before, shows the high risk potential of bakeries in orange, based on the coordinates. Furthermore, from among the bakeries with high risk, the ones that have failed an inspection in some form are highlighted in a red, indicating to the views of even higher concern.

### 4. Using the SBA Business Loans Data, do the following:

a. Create a visualization (plot) of at least two variables using this dataset
```{r}
SBA = read.csv("SBAnational.csv")
SBA$DisbursementGross = as.integer(SBA$DisbursementGross)
SBA$DisbursementDate = format(as.Date(SBA$DisbursementDate,format = "%d-%b-%y"),"%Y")
plot(DisbursementGross ~ DisbursementDate, data = SBA)
```

b. explain what is good and what is bad about the visualization

This plot does not really help conveying any information on disbursement, as there are too many points and they are cluttered across the plot.

c. show a substantially improved visualization
```{r}
curr = droplevels(filter(SBA, State == "IL", UrbanRural == 1, DisbursementDate >= "2000" & DisbursementDate <= "2013"))
Urban = curr %>% group_by(DisbursementDate) %>% summarize(average = mean(DisbursementGross)/1000)
curr = droplevels(filter(SBA, State == "IL", UrbanRural == 2,DisbursementDate >= "2000" & DisbursementDate <= "2013"))
Rural = curr %>% group_by(DisbursementDate) %>% summarize(average = mean(DisbursementGross)/1000)
plot(average ~ DisbursementDate, data = Urban, type = "n", xlab = "Year", ylab = "Gross in Thousands", main = "Disbursement in Illinois", ylim = c(20,80), axes = FALSE)
axis(2, at=axTicks(2), labels=sprintf("$%s", axTicks(2)), las=1)
axis(1)
lines(average~DisbursementDate,data = Urban, col="dodgerblue",lwd=2.5)
lines(average~DisbursementDate,data = Rural, col="darkorange",lwd=2.5)
text(2002,45, "URBAN", col = "dodgerblue")
text(2002,65, "RURAL", col = "darkorange")


```

d. describe the improvement and why the improved plot in part **c** helps the reader/viewer more than the original plot in part **a**.

This line graph helps the viewer see the trend of gross disbursement of banks, and differentiates between urban and rural areas of Illinois.

### 5. Using the SBA Business Loans Data, do the following:

a. create a table of descriptive statistics of your choice
```{r}
table(SBA$UrbanRural,SBA$MIS_Status)
```

b. add one descriptive statistic to the plot in part **1c**
```{r}
overall = (Rural$average + Urban$average)/2
plot(average ~ DisbursementDate, data = Urban, type = "n", xlab = "Year", ylab = "Gross in Thousands", main = "Disbursement in Illinois", ylim = c(20,80), axes = FALSE)
axis(2, at=axTicks(2), labels=sprintf("$%s", axTicks(2)), las=1)
axis(1)
lines(average~DisbursementDate,data = Urban, col="dodgerblue",lwd=2.5)
lines(average~DisbursementDate,data = Rural, col="darkorange",lwd=2.5)
lines(overall~Urban$DisbursementDate, col = "gray", lwd = 2.5)
text(2002,45, "URBAN", col = "dodgerblue")
text(2002,65, "RURAL", col = "darkorange")
text(2010, 60, "Average", col = "gray")

```

c. write a brief explanatory narrative of the visualization in part **2b**. In your explanation, be convincing and persuasive about your visualization. Attempt to highlight why this visualization is crucial to your imaginary supervisor.

This visual shows the gross disbursement of banks in Illinois over the course of 13 years from 2000 to 2013. Differentiating by color, the graph highlights the differences in the trends that banks in rural and urban areas followed.

## Select in-class tasks
	
Completion of select in-class tasks will be worth 1 point and will be graded largely by completion. Obvious errors and incomplete work will recieve deductions. 

1. Explain what the Riemannian sums simulator in Example 5b of the Week 7 Notes is doing. Why does it work reasonably well? Can you cook up an example where it will not work while keeping $n = 10000$ (Hint: think of the relationship between $a$, $b$, and $n$)?

The function makes a sorted vector of n values between a and b using the random uniform distribution function. It then takes the sum of all the values calculated using the given function to find the integration/Riemannian sum. 

2. Create a custom function that computes 3 different outlier detectors given a single vector of data. The function should return 6 cutoff values (2 for each outlier detector) from the following methods:
```{r}
out = function(x) {
  y = abs(x-mean(x))
  sig = x[which(y > 3*sd(x))]
  iqr = x[which(x < (quantile(x,0.25) - 1.5*IQR(x)) | x > (quantile(x,0.75) + 1.5*IQR(x)))]
  hamp = x[which(abs(x-median(x)) > 3*sd(x))]
}
```


a. 3 Sigma Rule $|x-\bar{x}|>3 \cdot \hat{\sigma}$ 
  
b. 1.5*IQR Rule $x<Q_1-1.5\cdot IQR$ or $x>Q_3+1.5 \cdot IQR$
  
c. Hampel Identifier $|x-\tilde{x}|> 3 \cdot \tilde{\sigma}$  
      - $\tilde{x}$ is the median of $x$  
      - $\tilde{\sigma}=1.4826 \cdot \textrm{median}\{|x-\tilde{x}|\}$ is the median of the absolute deviation from the median (MADM or MAD) scale estimate. 
	